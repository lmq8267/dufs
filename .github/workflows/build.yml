name: ç¼–è¯‘dufs

on:
#æ¯å¤©åŒ—äº¬æ—¶é—´11ç‚¹è‡ªåŠ¨æ£€æµ‹æ›´æ–°
  schedule:
   - cron: "0 3 * * *"
  workflow_dispatch:
    inputs:
      branch:
        description: 'æŒ‡å®šç¼–è¯‘çš„ç‰ˆæœ¬å·'
        required: false
        default: ''
      info:
        description: 'å‘å¸ƒReleaseçš„è¡¥å……è¯´æ˜'
        required: false
        default: ''
      bj:
        description: 'å¼ºåˆ¶ä½¿ç”¨æ‰‹åŠ¨ç¼–è¯‘'
        required: true
        default: false
        type: boolean
permissions:
  contents: write
  actions: write
env:
  TZ: Asia/Shanghai
  CARGO_TERM_COLOR: always
  BJ: ${{ github.event.inputs.bj }}
  BRANCH: ${{ github.event.inputs.branch }}

jobs:
  check:
   runs-on: ubuntu-latest
   outputs:
     ver: ${{ steps.getversion.outputs.ver }}
     tag: ${{ steps.getversion.outputs.tag }}
   steps:
   - name: æ£€æŸ¥æ›´æ–°
     id: getversion
     run: |
      ver=`curl https://api.github.com/repos/${GITHUB_REPOSITORY}/releases/latest | jq -r '.tag_name'`
      tag=`curl https://api.github.com/repos/sigoden/dufs/releases/latest | jq -r '.tag_name'`
      echo "ver=${ver}" >> $GITHUB_OUTPUT
      echo "tag=${tag}" >> $GITHUB_OUTPUT
   -  name: åˆ é™¤å·¥ä½œæµ
      uses: Mattraks/delete-workflow-runs@main
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        retain_days: 0
        keep_minimum_runs: 0
  build-assets:
    needs: check
    if: ${{ github.event.inputs.bj == 'true' || (github.event.inputs.bj != 'true' && needs.check.outputs.ver != needs.check.outputs.tag) }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
        with:
          repository: TransparentLC/dufs-material-assets
          ref: master
      - name: Setup pnpm
        uses: pnpm/action-setup@v3
        with:
          version: latest
      - name: Setup node
        uses: actions/setup-node@v4
        with:
          node-version: latest
          check-latest: true
          cache: pnpm
          cache-dependency-path: "**/package.json"
      - name: Build assets
        run: |
          pnpm install
          DUFS_EMBED_FILENAME=1 pnpm run build
      - name: Upload assets
        uses: actions/upload-artifact@v4
        with:
          name: dufs-è‡ªå®šä¹‰é¡µé¢
          path: dist

  
  build-dufs:
    needs: 
     - build-assets
     - check
    name: ğŸ›  ${{ matrix.NAME }}
    strategy:
      fail-fast: false
      matrix:
        include:
        # å®˜æ–¹åŸç‰ˆæµç¨‹
        - target: aarch64-apple-darwin
          os: macos-latest
          NAME: dufs-aarch64-apple-darwin
          
        - target: aarch64-pc-windows-msvc
          os: windows-latest
          NAME: dufs-aarch64-pc-windows-msvc.exe
          
        - target: x86_64-apple-darwin
          os: macos-latest
          NAME: dufs-x86_64-apple-darwin
          
        - target: x86_64-pc-windows-msvc
          os: windows-latest
          NAME: dufs-x86_64-pc-windows-msvc.exe
          
        - target: i686-pc-windows-msvc
          os: windows-latest
          NAME: dufs-i686-pc-windows-msvc.exe
          
        - target: aarch64-unknown-linux-musl
          os: ubuntu-latest
          URL: aarch64-linux-musl
          NAME: dufs-aarch64-linux-musl
          
        - target: x86_64-unknown-linux-musl
          os: ubuntu-latest
          URL: x86_64-linux-musl
          NAME: dufs-x86_64-linux-musl
            
        - target: i686-unknown-linux-musl
          os: ubuntu-latest
          URL: i686-linux-musl
          NAME: dufs-i686-linux-musl
        
        - target: armv7-unknown-linux-musleabihf
          os: ubuntu-latest
          URL: armv7l-linux-musleabihf
          NAME: dufs-armv7-linux-musleabihf

        - target: armv7-unknown-linux-musleabi
          os: ubuntu-latest
          URL: armv7m-linux-musleabi
          NAME: dufs-armv7-linux-musleabi
          
        - target: arm-unknown-linux-musleabihf
          os: ubuntu-latest
          URL: arm-linux-musleabihf
          NAME: dufs-arm-linux-musleabihf

        - target: arm-unknown-linux-musleabi
          os: ubuntu-latest
          URL: arm-linux-musleabi
          NAME: dufs-arm-linux-musleabi

        - target: mipsel-unknown-linux-musl
          os: ubuntu-latest
          URL: mipsel-linux-muslsf
          NAME: dufs-mipsel-linux-muslsf

        - target: mips-unknown-linux-musl
          os: ubuntu-latest
          URL: mips-linux-muslsf
          NAME: dufs-mips-linux-muslsf

        - target: x86_64-unknown-freebsd
          os: ubuntu-latest
          NAME: dufs-x86_64-freebsd

        # ä¿®æ”¹å‰ç«¯æ ·å¼çš„æµç¨‹
        - target: aarch64-apple-darwin
          os: macos-latest
          NAME: dufs-aarch64-apple-darwin_themed
          
        - target: aarch64-pc-windows-msvc
          os: windows-latest
          NAME: dufs-aarch64-pc-windows-msvc_themed.exe
          
        - target: x86_64-apple-darwin
          os: macos-latest
          NAME: dufs-x86_64-apple-darwin_themed
          
        - target: x86_64-pc-windows-msvc
          os: windows-latest
          NAME: dufs-x86_64-pc-windows-msvc_themed.exe
          
        - target: i686-pc-windows-msvc
          os: windows-latest
          NAME: dufs-i686-pc-windows-msvc_themed.exe
          
        - target: aarch64-unknown-linux-musl
          os: ubuntu-latest
          URL: aarch64-linux-musl
          NAME: dufs-aarch64-linux-musl_themed
          
        - target: x86_64-unknown-linux-musl
          os: ubuntu-latest
          URL: x86_64-linux-musl
          NAME: dufs-x86_64-linux-musl_themed
            
        - target: i686-unknown-linux-musl
          os: ubuntu-latest
          URL: i686-linux-musl
          NAME: dufs-i686-linux-musl_themed
        
        - target: armv7-unknown-linux-musleabihf
          os: ubuntu-latest
          URL: armv7l-linux-musleabihf
          NAME: dufs-armv7-linux-musleabihf_themed

        - target: armv7-unknown-linux-musleabi
          os: ubuntu-latest
          URL: armv7m-linux-musleabi
          NAME: dufs-armv7-linux-musleabi_themed
          
        - target: arm-unknown-linux-musleabihf
          os: ubuntu-latest
          URL: arm-linux-musleabihf
          NAME: dufs-arm-linux-musleabihf_themed

        - target: arm-unknown-linux-musleabi
          os: ubuntu-latest
          URL: arm-linux-musleabi
          NAME: dufs-arm-linux-musleabi_themed

        - target: mipsel-unknown-linux-musl
          os: ubuntu-latest
          URL: mipsel-linux-muslsf
          NAME: dufs-mipsel-linux-muslsf_themed

        - target: mips-unknown-linux-musl
          os: ubuntu-latest
          URL: mips-linux-muslsf
          NAME: dufs-mips-linux-muslsf_themed

        - target: x86_64-unknown-freebsd
          os: ubuntu-latest
          NAME: dufs-x86_64-freebsd_themed
            
    runs-on: ${{ matrix.os }}
    env:
      TARGET: ${{ matrix.target }}
      URL: ${{ matrix.URL }}
      NAME: ${{ matrix.NAME }}
    outputs:
      TAG: ${{ steps.set-tag.outputs.TAG }}
    steps:
      - name: ç¡®å®šç‰ˆæœ¬å·
        id: set-tag
        shell: bash
        run: |
          if [[ "${{ env.BJ }}" == "true" ]]; then
            echo "å¼ºåˆ¶è¿›è¡Œç¼–è¯‘..."
            if [[ -n "${{ github.event.inputs.branch }}" ]]; then
                echo "ä½¿ç”¨æ‰‹åŠ¨æŒ‡å®šçš„ç‰ˆæœ¬ï¼š${{ github.event.inputs.branch }}"
                TAG=${{ github.event.inputs.branch }}
                echo "TAG=$TAG" >> $GITHUB_ENV
            else
                echo "ä½¿ç”¨è‡ªåŠ¨è·å–çš„ç‰ˆæœ¬ï¼š${{ needs.check.outputs.tag }}"
                TAG=${{ needs.check.outputs.tag }}
                echo "TAG=$TAG" >> $GITHUB_ENV
            fi
          else
            echo "ä½¿ç”¨è‡ªåŠ¨è·å–çš„ç‰ˆæœ¬ï¼š${{ needs.check.outputs.tag }}"
            TAG=${{ needs.check.outputs.tag }}
            echo "TAG=$TAG" >> $GITHUB_ENV
          fi
          echo "TAG=$TAG" >> $GITHUB_OUTPUT
          
          NAME="${MATRIX_NAME}"
          if [[ "$NAME" == *.exe ]]; then
            NAME="${NAME%.exe}"
          fi
          echo "ARTIFACT_NAME=$NAME" >> $GITHUB_ENV
        env:
          MATRIX_NAME: ${{ matrix.NAME }}
          
      - uses: actions/checkout@v5
        with:
          repository: sigoden/dufs
          ref: ${{ env.TAG }}
          
      - name: ä¸‹è½½apple-windowså·¥å…·é“¾
        if: ${{ matrix.TARGET == 'aarch64-apple-darwin' || matrix.TARGET == 'aarch64-pc-windows-msvc' || matrix.TARGET == 'x86_64-apple-darwin' || matrix.TARGET == 'x86_64-pc-windows-msvc' || matrix.TARGET == 'i686-pc-windows-msvc' || matrix.TARGET == 'x86_64-unknown-freebsd' }}
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: ${{ matrix.target }}
          
      - name: ä¸‹è½½apple-windowsç¼–è¯‘å·¥å…·
        if: ${{ matrix.TARGET == 'aarch64-apple-darwin' || matrix.TARGET == 'aarch64-pc-windows-msvc' || matrix.TARGET == 'i686-pc-windows-msvc' || matrix.TARGET == 'x86_64-unknown-freebsd' }}
        uses: taiki-e/install-action@v2
        with:
          tool: cross
      - name: ä¸‹è½½linuxç¼–è¯‘å·¥å…·
        if: ${{ matrix.TARGET != 'aarch64-apple-darwin' && matrix.TARGET != 'aarch64-pc-windows-msvc' && matrix.TARGET != 'x86_64-apple-darwin' && matrix.TARGET != 'x86_64-pc-windows-msvc' && matrix.TARGET != 'i686-pc-windows-msvc' && matrix.TARGET != 'x86_64-unknown-freebsd' }}
        run: |
          mkdir -p /opt/musl_gcc
          rustup set auto-self-update disable
          echo "ä¸‹è½½https://github.com/lmq8267/Toolchain/releases/download/musl-cross/${{ env.URL }}-cross.tgz"
          wget -q -c https://github.com/lmq8267/Toolchain/releases/download/musl-cross/${{ env.URL }}-cross.tgz -P /opt/musl_gcc/
          tar zxf /opt/musl_gcc/${{ env.URL }}-cross.tgz -C /opt/musl_gcc/
          sudo ln -s /opt/musl_gcc/${{ env.URL }}-cross/bin/*gcc /usr/bin/
          sudo apt-get update && sudo apt-get install -qq crossbuild-essential-arm64 crossbuild-essential-armhf musl-tools
          if [[ $TARGET =~ ^mips.*$ ]]; then
            cd "/opt/musl_gcc/${{ env.URL }}-cross/lib/gcc/${{ env.URL }}/11.2.1" || exit 255
            cp libgcc_eh.a libunwind.a
            ar x libgcc.a _ctzsi2.o _clz.o _bswapsi2.o
            ar rcs libctz.a _ctzsi2.o _clz.o _bswapsi2.o

            rustup toolchain install nightly-2026-02-02-x86_64-unknown-linux-gnu
            rustup component add rust-src --toolchain nightly-2026-02-02-x86_64-unknown-linux-gnu
            # https://github.com/rust-lang/rust/issues/128808
            # remove it after Cargo or rustc fix this.
            RUST_LIB_SRC=$HOME/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/
            if [[ -f $RUST_LIB_SRC/library/Cargo.lock && ! -f $RUST_LIB_SRC/Cargo.lock ]]; then 
               cp -f $RUST_LIB_SRC/library/Cargo.lock $RUST_LIB_SRC/Cargo.lock
            fi
          else
            rustup target add ${{ env.TARGET }}
          fi
          
          #æ·»åŠ äº¤å‰ç¼–è¯‘é…ç½®
          cat >>~/.cargo/config <<EOF
          [target.x86_64-unknown-linux-musl]
          linker = "x86_64-linux-musl-gcc"
          rustflags = ["-C", "target-feature=+crt-static"]
          
          [target.i686-unknown-linux-musl]
          linker = "i686-linux-musl-gcc"
          rustflags = ["-C", "target-feature=+crt-static"] 
          
          [target.aarch64-unknown-linux-musl]
          linker = "aarch64-linux-musl-gcc"
          rustflags = ["-C", "target-feature=+crt-static"]
          
          [target.armv7-unknown-linux-musleabi]
          linker = "armv7m-linux-musleabi-gcc"
          rustflags = ["-C", "target-feature=+crt-static"]

          [target.armv7-unknown-linux-musleabihf]
          linker = "armv7l-linux-musleabihf-gcc"
          rustflags = ["-C", "target-feature=+crt-static"]
          
          [target.arm-unknown-linux-musleabi]
          linker = "arm-linux-musleabi-gcc"
          rustflags = ["-C", "target-feature=+crt-static"]

          [target.arm-unknown-linux-musleabihf]
          linker = "arm-linux-musleabihf-gcc"
          rustflags = ["-C", "target-feature=+crt-static"]

          [target.x86_64-pc-windows-msvc]
          rustflags = ["-C", "target-feature=+crt-static"]
          
          [target.i686-pc-windows-msvc]
          rustflags = ["-C", "target-feature=+crt-static"]

          [target.aarch64-pc-windows-msvc]
          rustflags = ["-C", "target-feature=+crt-static"]

          [target.x86_64-apple-darwin]
          rustflags = ["-C", "target-feature=+crt-static"]
          
          [target.aarch64-apple-darwin]
          rustflags = ["-C", "target-feature=+crt-static"]
          
          [target.mipsel-unknown-linux-musl]
          linker = "/opt/musl_gcc/mipsel-linux-muslsf-cross/bin/mipsel-linux-muslsf-gcc"
          rustflags = ["-C", "target-feature=+crt-static",
          "-L", "/opt/musl_gcc/mipsel-linux-muslsf-cross/mipsel-linux-muslsf/lib",
          "-L", "/opt/musl_gcc/mipsel-linux-muslsf-cross/lib/gcc/mipsel-linux-muslsf/11.2.1",
          "-l", "atomic",
          "-l", "ctz",
          "-l", "gcc"]
          
          [target.mips-unknown-linux-musl]
          linker = "/opt/musl_gcc/mips-linux-muslsf-cross/bin/mips-linux-muslsf-gcc"
          rustflags = ["-C", "target-feature=+crt-static",
          "-L", "/opt/musl_gcc/mips-linux-muslsf-cross/mips-linux-muslsf/lib",
          "-L", "/opt/musl_gcc/mips-linux-muslsf-cross/lib/gcc/mips-linux-muslsf/11.2.1",
          "-l", "atomic",
          "-l", "ctz",
          "-l", "gcc"]      
          EOF
      - name: æ‰“å°ç‰ˆæœ¬ä¿¡æ¯ (Rust, cargo, GCC)
        shell: bash
        run: |
          rustup -V
          rustup toolchain list
          rustup default
          cargo -V
          rustc -V
      - name: ä¸‹è½½ assets é¡µé¢
        if: contains(matrix.NAME, '_themed')
        uses: actions/download-artifact@v4
        with:
          name: dufs-è‡ªå®šä¹‰é¡µé¢
          path: dufs-material-assets-embed
      - name: æ›¿æ¢è‡ªå®šä¹‰ assets é¡µé¢
        if: contains(matrix.NAME, '_themed')
        shell: bash
        run: |
          cp dufs-material-assets-embed/index.css assets/index.css
          cp dufs-material-assets-embed/index.html assets/index.html
          cp dufs-material-assets-embed/index.js assets/index.js
      - name: ç¼–è¯‘dufs
        shell: bash
        run: |
          echo "å¼€å§‹ä¿®æ”¹ Cargo.toml å†™å…¥ thunk-rs ä»¥æ”¯æŒwin7..."
          printf '\n[target.x86_64-pc-windows-msvc.build-dependencies]\nthunk-rs = { version = "0.3.3", features = ["win7"] }\n\n[target.i686-pc-windows-msvc.build-dependencies]\nthunk-rs = { version = "0.3.3", features = ["win7"] }\n\n[target.aarch64-pc-windows-msvc.build-dependencies]\nthunk-rs = { version = "0.3.3", features = ["win7"] }\n' >> Cargo.toml
          echo "åˆ›å»º build.rs æ–‡ä»¶..."
          printf '// é…ç½® thunk-rs æ¥é“¾æ¥ Windows 7 å…¼å®¹åº“ï¼Œå¹¶è‡ªåŠ¨è®¾ç½®é“¾æ¥å‚æ•°\n#[cfg(target_os = "windows")]\nfn main() {\n    if !std::env::var("TARGET").unwrap_or_default().contains("aarch64") {\n        thunk::thunk();\n    }\n}\n\n#[cfg(not(target_os = "windows"))]\nfn main() {}\n' > build.rs
            
          if [[ $TARGET == 'aarch64-apple-darwin' || $TARGET == 'aarch64-pc-windows-msvc' || $TARGET == 'i686-pc-windows-msvc' || $TARGET == 'x86_64-unknown-freebsd' ]]; then
            echo "ç¼–è¯‘ï¼š cross build --locked --release --target=${{ matrix.target }}"
            cross build --release --target=${{ matrix.target }}
          else
            echo "ç¼–è¯‘ï¼š cargo build --locked --release --target=${{ matrix.target }}"
            if [[ $TARGET =~ ^mips.*$ ]]; then
              cargo +nightly-2026-02-02 build --release --target=${{ matrix.target }} -Z build-std=std,panic_abort
            else
              cargo build --release --target=${{ matrix.target }}
            fi
          fi
            
          cd target/${{ matrix.target }}/release
          mkdir -p ./out
          if [[ "$RUNNER_OS" == "Windows" ]]; then
            mv ./dufs.exe ./out/${{ matrix.NAME }}
          else
            mv ./dufs ./out/${{ matrix.NAME }}
          fi
          
          ls -alh ./out/
          echo "build_time=$(TZ=UTC-8 date '+%Yå¹´%mæœˆ%dæ—¥%H:%M:%S' | jq -sRr @uri)" >> $GITHUB_ENV
      - name: å®‰è£… UPX
        if: ${{ matrix.TARGET != 'aarch64-apple-darwin' && matrix.TARGET != 'aarch64-pc-windows-msvc' && matrix.TARGET != 'x86_64-apple-darwin' && matrix.TARGET != 'x86_64-pc-windows-msvc' && matrix.TARGET != 'i686-pc-windows-msvc' && matrix.TARGET != 'x86_64-unknown-freebsd' }}
        uses: crazy-max/ghaction-upx@v3
        with:
          version: v4.2.4
          install-only: true
      - name: å‹ç¼©ç¨‹åº
        if: ${{ matrix.TARGET != 'aarch64-apple-darwin' && matrix.TARGET != 'aarch64-pc-windows-msvc' && matrix.TARGET != 'x86_64-apple-darwin' && matrix.TARGET != 'x86_64-pc-windows-msvc' && matrix.TARGET != 'i686-pc-windows-msvc' && matrix.TARGET != 'x86_64-unknown-freebsd' }}
        run: |
          cd target/${{ matrix.target }}/release/out
          cp ${{ matrix.NAME }} ${{ matrix.NAME }}-upx
          upx --lzma --best ${{ matrix.NAME }}-upx
      - name: ä¸Šä¼ ç¨‹åº
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.ARTIFACT_NAME }}
          path: target/${{ matrix.target }}/release/out/*

  release:
    needs: build-dufs
    env:
      TAG: ${{ needs.build-dufs.outputs.TAG }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ä»£ç 
        uses: actions/checkout@v5

      - name: ä¸‹è½½å·²ä¸Šä¼ çš„æ–‡ä»¶
        uses: actions/download-artifact@v4
        with:
         path: dufs_files

      - name: è®¾ç½®æ„å»ºæ—¶é—´
        run: |
         mkdir -p release
         sudo timedatectl set-timezone "Asia/Shanghai"
         # éå†ä¸‹è½½çš„æ¯ä¸ª artifact å­æ–‡ä»¶å¤¹ï¼ŒæŠŠé‡Œé¢çš„äºŒè¿›åˆ¶ç§»åŠ¨åˆ° release/
         for dir in dufs_files/*; do
          if [ -d "$dir" ]; then
           mv "$dir"/* release/
          fi
         done
         echo "build_time=$(date '+%Yå¹´%mæœˆ%dæ—¥%H:%M:%S' | jq -sRr @uri)" >> $GITHUB_ENV

      - name: å‘å¸ƒ
        uses: softprops/action-gh-release@v2
        with:
            token: ${{ github.token }}
            body: |
             > ### ![](https://img.shields.io/badge/%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4-${{ env.build_time }}-8267?logo=github&labelColor=%E9%A1%BB)![](https://img.shields.io/github/downloads/${{ github.repository }}/${{ env.TAG }}/total?label=%E4%B8%8B%E8%BD%BD%E6%AC%A1%E6%95%B0&logo=github) 

             ### ğŸ“¦ ç‰ˆæœ¬è¯´æ˜

             - ğŸ¨ **åŒ…å« `_themed` åç¼€**ï¼š  
                é›†æˆ :[TransparentLC/dufs-material-assets](https://github.com/TransparentLC/dufs-material-assets)çš„å‰ç«¯æ ·å¼ï¼ˆç¾åŒ–ç•Œé¢åŠåŠŸèƒ½ï¼‰

             - ğŸ“„ **ä¸åŒ…å« `_themed` åç¼€**ï¼š  
               å®˜æ–¹åŸç‰ˆç•Œé¢ï¼Œæ¥è‡ª :[sigoden/dufs](https://github.com/sigoden/dufs) ï¼ˆä½“ç§¯ç›¸å¯¹å°å‡ ç™¾kï¼‰

             ### âš™ï¸ å…¶ä»–è¯´æ˜

             - **`-upx` åç¼€**ï¼šä½¿ç”¨ UPX å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä½“ç§¯æ›´å°ï¼‰
             - **`index.css` `index.html` `index.js`**ï¼š[TransparentLC/dufs-material-assets](https://github.com/TransparentLC/dufs-material-assets)çš„å‰ç«¯æ ·å¼æ–‡ä»¶
             - æ‰€æœ‰ç‰ˆæœ¬å‡ä¸ºè‡ªåŠ¨æ„å»º

             ### ğŸ”— ç›¸å…³é¡¹ç›®

             - å®˜æ–¹é¡¹ç›®ï¼šhttps://github.com/sigoden/dufs
             - å‰ç«¯ä¸»é¢˜ï¼šhttps://github.com/TransparentLC/dufs-material-assets
             - ç‰ˆæœ¬æ›´æ–°è¯´æ˜ï¼šhttps://github.com/sigoden/dufs/releases
 

              ${{ github.event.inputs.info }}
              
            tag_name: ${{ env.TAG }}
            files: release/*
  keepalive-workflow:
    # githubè¶…è¿‡60å¤©æœªæäº¤å°†è‡ªåŠ¨åœæ­¢å·¥ä½œæµ
    name: å·¥ä½œæµä¿æ´» 
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: write
    steps:
      - uses: actions/checkout@v4
      #- uses: gautamkrishnar/keepalive-workflow@v2
        #with:
          #use_api: true
      - name: æ£€æŸ¥ä¸Šæ¬¡æäº¤æ—¥æœŸ
        id: check_commit_date
        run: |
          # è·å–ä¸Šæ¬¡æäº¤æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
          LAST_COMMIT_DATE=$(git log -1 --format=%cd --date=short)
          echo "ä¸Šæ¬¡æäº¤æ—¥æœŸ: $LAST_COMMIT_DATE"
          # è®¡ç®—å½“å‰æ—¥æœŸå’Œä¸Šæ¬¡æäº¤æ—¥æœŸçš„å·®å€¼ï¼ˆå•ä½ï¼šå¤©ï¼‰
          LAST_COMMIT_TIMESTAMP=$(date -d "$LAST_COMMIT_DATE" +%s)
          CURRENT_TIMESTAMP=$(date +%s)
          DIFF_DAYS=$(( (CURRENT_TIMESTAMP - LAST_COMMIT_TIMESTAMP) / 86400 ))
          echo "è·ç¦»ä¸Šæ¬¡æäº¤ä»¥æ¥çš„å¤©æ•°: $DIFF_DAYS"
          echo "diff_days=$DIFF_DAYS" >> $GITHUB_ENV
      - name: æ‰§è¡Œç©ºæäº¤
        if: ${{ env.diff_days > 50 }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          # åˆ›å»ºç©ºæäº¤
          git commit --allow-empty -m "è‡ªåŠ¨ç©ºæäº¤ï¼Œä¿æŒä»“åº“æ´»è·ƒ"
          git push
